tosca_definitions_version: tosca_simple_yaml_1_0_0
metadata:
  template_name: Main
imports:
- openecomp_heat_index:
    file: openecomp-heat/_index.yml
node_types:
  org.openecomp.resource.vfc.nodes.heat.MASTER:
    derived_from: org.openecomp.resource.vfc.nodes.heat.nova.Server
topology_template:
  inputs:
    MASTER_image_name:
      hidden: false
      immutable: false
      type: string
      description: JSA MASTER instance image name
    MASTER_names:
      hidden: false
      immutable: false
      type: string
      description: JSA MASTER instance name
    security_group_name:
      hidden: false
      immutable: false
      type: string
      description: security group name of JSA
    MASTER_flavor_name:
      hidden: false
      immutable: false
      type: string
      description: the flavor name of JSA MASTER instance
    oam_net_name:
      hidden: false
      immutable: false
      type: string
      description: network name of OAM network
  node_templates:
    jsa_security_group:
      type: org.openecomp.resource.vfc.rules.nodes.heat.network.neutron.SecurityRules
      properties:
        name:
          get_input: security_group_name
        description: ems security group
        rules:
        - protocol: tcp
          ethertype: IPv4
          port_range_max: 65535
          remote_ip_prefix: 0.0.0.0/0
          direction: egress
          port_range_min: 1
        - protocol: udp
          ethertype: IPv4
          port_range_max: 65535
          remote_ip_prefix: 0.0.0.0/0
          direction: egress
          port_range_min: 1
        - protocol: icmp
          ethertype: IPv4
          remote_ip_prefix: 0.0.0.0/0
          direction: egress
        - protocol: tcp
          ethertype: IPv6
          port_range_max: 65535
          remote_ip_prefix: ::/0
          direction: egress
          port_range_min: 1
        - protocol: udp
          ethertype: IPv6
          port_range_max: 65535
          remote_ip_prefix: ::/0
          direction: egress
          port_range_min: 1
        - protocol: icmp
          ethertype: IPv6
          remote_ip_prefix: ::/0
          direction: egress
        - protocol: tcp
          ethertype: IPv4
          port_range_max: 65535
          remote_ip_prefix: 0.0.0.0/0
          direction: ingress
          port_range_min: 1
        - protocol: udp
          ethertype: IPv4
          port_range_max: 65535
          remote_ip_prefix: 0.0.0.0/0
          direction: ingress
          port_range_min: 1
        - protocol: icmp
          ethertype: IPv4
          remote_ip_prefix: 0.0.0.0/0
          direction: ingress
        - protocol: tcp
          ethertype: IPv6
          port_range_max: 65535
          remote_ip_prefix: ::/0
          direction: ingress
          port_range_min: 1
        - protocol: udp
          ethertype: IPv6
          port_range_max: 65535
          remote_ip_prefix: ::/0
          direction: ingress
          port_range_min: 1
        - protocol: icmp
          ethertype: IPv6
          remote_ip_prefix: ::/0
          direction: ingress
      requirements:
      - port:
          capability: tosca.capabilities.Attachment
          node: MASTER_mgmt_port
          relationship: org.openecomp.relationships.AttachesTo
    MASTER_mgmt_port:
      type: org.openecomp.resource.cp.nodes.heat.network.neutron.Port
      properties:
        ip_requirements:
        - ip_version: 4
          ip_count_required:
            is_required: false
          floating_ip_count_required:
            is_required: false
        security_groups:
        - jsa_security_group
        mac_requirements:
          mac_count_required:
            is_required: false
        network_role_tag: oam
        network:
          get_input: oam_net_name
      requirements:
      - binding:
          capability: tosca.capabilities.network.Bindable
          node: MASTER_instance
          relationship: tosca.relationships.network.BindsTo
    MASTER_instance:
      type: org.openecomp.resource.vfc.nodes.heat.MASTER
      properties:
        flavor:
          get_input: MASTER_flavor_name
        image:
          get_input: MASTER_image_name
        name:
          get_input: MASTER_names
  groups:
    hot_template_group:
      type: org.openecomp.groups.heat.HeatStack
      properties:
        heat_file: ../Artifacts/hot_template.yml
        description: |
          Version 2.0 02-11-2016 (Authors: John Doe, user PROD)
      members:
      - jsa_security_group
      - MASTER_mgmt_port
      - MASTER_instance