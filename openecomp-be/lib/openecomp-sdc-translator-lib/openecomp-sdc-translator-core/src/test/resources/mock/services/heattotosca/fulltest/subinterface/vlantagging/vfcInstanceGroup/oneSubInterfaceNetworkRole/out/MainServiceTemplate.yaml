tosca_definitions_version: tosca_simple_yaml_1_0_0
metadata:
  template_name: Main
imports:
- openecomp_heat_index:
    file: openecomp-heat/_index.yml
- GlobalSubstitutionTypes:
    file: GlobalSubstitutionTypesServiceTemplate.yaml
topology_template:
  inputs:
    vf_module_id:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vf_module_id
      type: string
      description: Unique ID for this VF module inst
    control_int_net_rpf:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: control_int_net_rpf
      type: string
      description: Reverse Path Filtering enable or disable for the control virtual network
    control_int_net_forwarding_mode:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: control_int_net_forwarding_mode
      type: string
      description: forwarding mode of the control virtual network
    vnf_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vnf_name
      type: string
      description: Unique name for this VF instance
    vdbe_untrusted_ip_1:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_untrusted_ip_1
      type: string
      description: IPV4 address of the secondary vDBE VM on the VAN untrusted network
    vdbe_aap_untrusted_ip_prefix_len:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_untrusted_ip_prefix_len
      type: string
      description: ip prefix length for the primary vDBE VM on the VAN untrusted network
    untrusted_num_vn:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: untrusted_num_vn
      type: float
      description: Number of vDBE subinterface virtual Networks
      constraints:
      - in_range:
        - 1
        - 77
    aap_address_mode:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: aap_address_mode
      type: string
      description: Address mode for the vDBE cluster IP
    control_int_net_shared:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: control_int_net_shared
      type: boolean
      description: control virtual network shared
    vdbe_untrusted_v6_ip_1:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_untrusted_v6_ip_1
      type: string
      description: IPV6 address of the secondary vDBE VM on the VAN untrusted network
    vdbe_untrusted_vmac_address:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_untrusted_vmac_address
      type: string
      description: Virtual MAC of the primary vDBE VM on the VAN untrusted network
    control_int_net_flood_unknown_unicast:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: control_int_net_flood_unknown_unicast
      type: boolean
      description: forwarding mode of the control virtual network
    vdbe_aap_sec_untrusted_ip_prefix:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_sec_untrusted_ip_prefix
      type: string
      description: ip prefix for secondary vDBE VM aap on the VAN untrusted network
    vnf_id:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vnf_id
      type: string
      description: Unique ID for this VF inst
    vdbe_name_1:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_name_1
      type: string
      description: VM Name for this vdbe node 1
    availability_zone_1:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: availability_zone_1
      type: string
      description: The availability zone of secondary node1 vDBE vm in the local HA pair.
    untrusted_vn_networks:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: untrusted_vn_networks
      type: list
      description: List of subinterface virtual networks
      entry_schema:
        type: string
    vdbe_image_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_image_name
      type: string
      description: Image to use for vDBE
    oam_net_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: oam_net_name
      type: string
      description: Name of NSDNet network from which the management IP addresses will be allocated
    vdbe_aap_sec_untrusted_ip_prefix_len:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_sec_untrusted_ip_prefix_len
      type: string
      description: ip prefix length for the secondary DBE VM aap on the VAN untrusted network
    vdbe_aap_untrusted_v6_ip_prefix:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_untrusted_v6_ip_prefix
      type: string
      description: ipv6 prefix for the primary vDBE VM on the VAN untrusted network
    vdbe_aap_untrusted_v6_ip_prefix_len:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_untrusted_v6_ip_prefix_len
      type: string
      description: ipv6 prefix length for the primary vDBE VM on the VAN untrusted network
    untrusted_vlan_tags:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: untrusted_vlan_tags
      type: list
      description: List of subinterface vlan tags
      entry_schema:
        type: string
    untr_network_collection_function:
      type: string
      required: true
    untr_vfc_instance_group_function:
      type: string
      required: true
    vdbe_flavor_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_flavor_name
      type: string
      description: Flavor to use for vDBE
    counter:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: counter
      type: float
      description: Counter.
    vdbe_hw_untr_mac_1:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_hw_untr_mac_1
      type: string
      description: Secondary MAC address of the secondary vDBE VM on the VAN untrusted network
    untrusted_net_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: untrusted_net_name
      type: string
      description: Name of public untrusted network into which this vDBE HA cluster is deployed
    vdbe_device_name:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_device_name
      type: string
      description: VDBE device Name for this vdbe VNF
    vdbe_aap_untrusted_ip_prefix:
      hidden: false
      immutable: false
      annotations:
        source:
          type: org.openecomp.annotations.Source
          properties:
            vf_module_label:
            - main
            source_type: HEAT
            param_name: vdbe_aap_untrusted_ip_prefix
      type: string
      description: ip prefix for primary vDBE VM on the VAN untrusted network
  node_templates:
    control_int_net:
      type: org.openecomp.resource.vl.nodes.heat.network.contrailV2.VirtualNetwork
      properties:
        network_name:
          str_replace:
            template: VNF_NAME_control_net
            params:
              VNF_NAME:
                get_input: vnf_name
    abstract_vdbe:
      type: org.openecomp.resource.abstract.nodes.vdbe
      directives:
      - substitutable
      properties:
        subinterface_vdbe_untr_1_subports_ip_address:
        - get_input: vdbe_untrusted_ip_1
        subinterface_vdbe_untr_1_subports_aap_sec_untrusted_ip_prefix:
        - get_input: vdbe_aap_sec_untrusted_ip_prefix
        subinterface_vdbe_untr_2_subports_aap_untrusted_v6_ip_prefix:
        - get_input: vdbe_aap_untrusted_v6_ip_prefix
        compute_vdbe_availability_zone:
        - get_input: availability_zone_1
        subinterface_vdbe_untr_2_subports_aap_address_mode:
        - get_input: aap_address_mode
        vm_flavor_name:
          get_input: vdbe_flavor_name
        subinterface_vdbe_untr_2_subports_aap_untrusted_ip_prefix_len:
        - get_input: vdbe_aap_untrusted_ip_prefix_len
        subinterface_vdbe_untr_1_subports_mac_address:
        - get_input: vdbe_hw_untr_mac_1
        subinterface_vdbe_untr_1_subports_subinterfaces_name_prefix:
        - str_replace:
            template: VM_NAMEDBE001p1n004
            params:
              DBE:
                get_input: vdbe_device_name
              VM_NAME:
                get_input: vdbe_name_1
        vm_image_name:
          get_input: vdbe_image_name
        subinterface_vdbe_untr_1_subports_aap_untrusted_v6_ip_prefix_len:
        - get_input: vdbe_aap_untrusted_v6_ip_prefix_len
        compute_vdbe_metadata:
        - vf_module_id:
            get_input: vf_module_id
          vnf_id:
            get_input: vnf_id
          vnf_name:
            get_input: vnf_name
        subinterface_vdbe_untr_2_subports_counter:
        - get_input: counter
        subinterface_vdbe_untr_2_subports_vmac_address:
        - get_input: vdbe_untrusted_vmac_address
        subinterface_vdbe_untr_1_subports_aap_address_mode:
        - get_input: aap_address_mode
        subinterface_vdbe_untr_2_subports_vlan_tag_list:
        - get_input: untrusted_vlan_tags
        subinterface_vdbe_untr_1_subports_vn_network_list:
        - get_input: untrusted_vn_networks
        port_vdbe_untr_port_name:
        - str_replace:
            template: VM_NAMEDBE001p1n004
            params:
              DBE:
                get_input: vdbe_device_name
              VM_NAME:
                get_input: vdbe_name_1
        subinterface_vdbe_untr_2_subports_vn_network_list:
        - get_input: untrusted_vn_networks
        subinterface_vdbe_untr_1_subports_aap_untrusted_v6_ip_prefix:
        - get_input: vdbe_aap_untrusted_v6_ip_prefix
        subinterface_vdbe_untr_2_subports_ip_v6_address:
        - get_input: vdbe_untrusted_v6_ip_1
        subinterface_vdbe_untr_2_subports_mac_address:
        - get_input: vdbe_hw_untr_mac_1
        subinterface_vdbe_untr_2_subports_aap_untrusted_v6_ip_prefix_len:
        - get_input: vdbe_aap_untrusted_v6_ip_prefix_len
        compute_vdbe_name:
        - get_input: vdbe_name_1
        subinterface_vdbe_untr_1_subports_aap_sec_untrusted_ip_prefix_len:
        - get_input: vdbe_aap_sec_untrusted_ip_prefix_len
        subinterface_vdbe_untr_2_subports_aap_sec_untrusted_ip_prefix_len:
        - get_input: vdbe_aap_sec_untrusted_ip_prefix_len
        port_vdbe_untr_port_ip_requirements:
        - ip_version: 4
          ip_count_required:
            is_required: false
          floating_ip_count_required:
            is_required: false
        subinterface_vdbe_untr_1_subports_vlan_tag_list:
        - get_input: untrusted_vlan_tags
        subinterface_vdbe_untr_2_subports_aap_untrusted_ip_prefix:
        - get_input: vdbe_aap_untrusted_ip_prefix
        subinterface_vdbe_untr_1_subports_aap_untrusted_ip_prefix:
        - get_input: vdbe_aap_untrusted_ip_prefix
        subinterface_vdbe_untr_1_subports_ip_v6_address:
        - get_input: vdbe_untrusted_v6_ip_1
        port_vdbe_untr_port_mac_requirements:
          mac_count_required:
            is_required: false
        subinterface_vdbe_untr_1_subports_parent_interface:
        - vdbe_1_untr_port_1
        subinterface_vdbe_untr_2_subports_service_template_filter_count:
        - 5
        subinterface_vdbe_untr_1_subports_service_template_filter_count:
        - get_input: untrusted_num_vn
        subinterface_vdbe_untr_2_subports_ip_address:
        - get_input: vdbe_untrusted_ip_1
        subinterface_vdbe_untr_1_subports_vmac_address:
        - get_input: vdbe_untrusted_vmac_address
        subinterface_vdbe_untr_2_subports_subinterfaces_name_prefix:
        - str_replace:
            template: VM_NAMEDBE001p1n004
            params:
              DBE:
                get_input: vdbe_device_name
              VM_NAME:
                get_input: vdbe_name_1
        subinterface_vdbe_untr_2_subports_aap_sec_untrusted_ip_prefix:
        - get_input: vdbe_aap_sec_untrusted_ip_prefix
        subinterface_vdbe_untr_1_subports_aap_untrusted_ip_prefix_len:
        - get_input: vdbe_aap_untrusted_ip_prefix_len
        subinterface_vdbe_untr_2_subports_parent_interface:
        - vdbe_1_untr_port_1
        service_template_filter:
          substitute_service_template: Nested_vdbeServiceTemplate.yaml
          count: 1
        index_value:
          get_property:
          - SELF
          - service_template_filter
          - index_value
  groups:
    main_group:
      type: org.openecomp.groups.heat.HeatStack
      properties:
        heat_file: ../Artifacts/main.yml
        description: |
          Version 2.0 02-09-2016 (Authors: John Doe, user PROD)
      members:
      - control_int_net
      - abstract_vdbe
    untr_group:
      type: org.openecomp.groups.VfcInstanceGroup
      properties:
        vfc_parent_port_role: untr
        network_collection_function:
          get_input: untr_network_collection_function
        vfc_instance_group_function:
          get_input: untr_vfc_instance_group_function
        subinterface_role: untr
      members:
      - abstract_vdbe